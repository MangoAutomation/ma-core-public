//>>built
define("xstyle/core/Rule",["xstyle/core/expression","put-selector/put","xstyle/core/utils"],function(m,n,p){function k(){}function q(a){this.caller=a;this.args=[]}var r=Object.create||function(a){function b(){}b.prototype=a;return new b},s={"{":"}","[":"]","(":")"},t=n("div");k.prototype={eachProperty:function(a){for(var b=this.values||0,c=0;c<b.length;c++){var d=b[c];a.call(this,d||"unnamed",b[d])}},fullSelector:function(){return(this.parent?this.parent.fullSelector():"")+(this.selector||"")+" "},
newRule:function(a){a=(this.rules||(this.rules={}))[a]=new k;a.disabled=this.disabled;return a},newCall:function(a,b,c){return new q(a)},addSheetRule:function(a,b){if(b&&"@"!=a.charAt(0)){var c=this.styleSheet,d=c.cssRules||c.rules,e=-1<this.ruleIndex?this.ruleIndex:d.length;c.addRule(a,b,e);return d[e]}},onRule:function(){var a=this.getCssRule();if(this.installStyles)for(var b=0;b<this.installStyles.length;b++){var c=this.installStyles[b];a.style[c[0]]=c[1]}},setStyle:function(a,b){this.cssRule?
this.cssRule.style[a]=b:(this.installStyles||(this.installStyles=[])).push([a,b])},getCssRule:function(){this.cssRule||(this.cssRule=this.addSheetRule(this.selector,this.cssText));return this.cssRule},get:function(a){return this.values[a]},elements:function(a){var b=this;require(["xstyle/core/elemental"],function(c){c.addRenderer(b,function(b){a(b)})})},declareProperty:function(a,b,c){if(!this.disabled)if(b.length)if("\x3e"==b[0].toString().charAt(0)){if(!a){this.generator=b;var d=this;require(["xstyle/core/generate",
"xstyle/core/elemental"],function(a,c){b=a(b,d);c.addRenderer(d,b)})}}else{var e=a in t.style||this.getDefinition(a);if(!c||!e){c=this.definitions||(this.definitions={});e=b[0];if(e.indexOf&&-1<e.indexOf(","))for(var e=b.join("").split(/\s*,\s*/),g=[],f=0;f<e.length;f++)g[f]=m(this,a,e[f]);b[0]&&"{"==b[0].operator?g=b[0]:b[1]&&"{"==b[1].operator&&(g=b[1]);c[a]=g||m(this,a,b)}}else c=this.definitions||(this.definitions={}),c[a]=b},onCall:function(a,b,c){var d=a.ref;if(d&&"function"==typeof d.call)return d.call(a,
this,b,c)},setValue:function(a,b,c){if(!this.disabled){var d=this.values||(this.values=[]);d.push(a);d[a]=b;if(d=b.calls)for(var e=0;e<d.length;e++)this.onCall(d[e],a,b);if(a){var g=a;do{if(d=(c||this).getDefinition(a)){var f=this;return p.when(d,function(a){a=a.splice?a:[a];for(var c=0;c<a.length;c++){var d;p.when(a[c],function(a){d=a.put&&a.put(b,f,g)});if(d)return d}})}a=a.substring(0,a.lastIndexOf("-"))}while(a)}}},put:function(a,b){this.extend(b);if("defaults"!=a&&a&&"string"==typeof a&&this.values)for(var c=
a.toString().split(/,\s*/),d=0;d<c.length;d++){var e=this.values[d];e&&b.setValue(e,c[d],this)}},extend:function(a,b){var c=this,d=c.cssText;if(a.cssRule)for(var d=c.cssRule.style,e=a.cssRule.style,g=a.inheritedStyles||(a.inheritedStyles={}),f=0;f<d.length;f++){var h=d[f];if(!e[h]||g[h])e[h]=d[h],g[h]=!0}else a.cssText+=d;"values,variables,calls".replace(/\w+/g,function(b){var d=c[b];d&&(a[b]=r(d))});if(b){if(d=c.definitions)a.definitions=r(d);a.tagName=c.tagName||a.tagName}a.base=c;c.eachProperty(function(b,
c){a.setValue(b,c)});c.generator&&a.declareProperty(null,c.generator)},getDefinition:function(a,b){var c=this;do var d=c.definitions&&c.definitions[a]||b&&c.rules&&c.rules[a],c=c.parent;while(!d&&c);return d},appendTo:function(a,b){return n(b||a,(b?"-":"")+(this.tagName||"span")+(this.selector||""))},cssText:""};var l=q.prototype=new k;l.declareProperty=l.setValue=function(a,b){this.args.push(b)};l.toString=function(){var a=this.operator;return a+this.args+s[a]};return k});
//@ sourceMappingURL=Rule.js.map